#!/usr/bin/env node
import meow from 'meow'
import chalk from 'chalk'
import path from 'path'
import errorHandler from '../error-handler'
import update from 'update-notifier'
import pkg from '../../package'
import {tasks} from '../'

const blue = chalk.blue
const bold = chalk.bold
const dim = chalk.dim
const green = chalk.green

const {input, flags} = meow({
  description: false,
  help: `
    ${bold('install a js file depends pkgs automatic using yarn')}

    ${bold('Usage:')}

        ${blue('$ pkg-reflector <file[s]> [options]')}

    ${bold('Options:')}

      ${blue('--dev, -d')}               ${dim('# save updated pkgs as devDependencies, default is dependencies')}

      ${blue('--here')}                  ${dim(`# install the pkgs in the cwd folder`)}

    ${bold('Examples:')}

      ${blue('$ pkg-reflector src/* --dev')}

      ${dim('# will install the file depends pkgs')}
  `
}, {
  alias: {
    h: 'help',
    v: 'version',
    d: 'dev'
  }
})

tasks(input, flags)
  .then((ctx) => {
    const updatedPkgs = ctx.deps.toString()
    console.log(green(`\n   ${updatedPkgs} installed !\n`))
  })
  .catch((err) => errorHandler(err))

update({pkg}).notify()
