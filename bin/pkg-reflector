#!/usr/bin/env node
const cac = require('cac')
const chalk = require('chalk')
const update = require('update-notifier')
const errorHandler = require('../src/error-handler')
const pkg = require('../package.json')
const { tasks } = require('../src')

const cli = cac()

update({pkg}).notify()

const defaultCommanad = cli.command('*', 'Find and install the npm modules your js files used', (input, flags) => {
  tasks(input, flags)
    .then((ctx) => {
      const updatedPkgs = ctx.deps.toString()
      console.log(chalk.green(`\n${chalk.gray.bgGreen.bold('success')} ${updatedPkgs} installed !\n`))
    })
    .catch(errorHandler)
})

defaultCommanad
  .option('dev', {
    desc: 'save updated pkgs as devDependencies, default is dependencies',
    type: 'boolean',
    alias: 'd'
  })
  .option('npm', {
    desc: `use 'npm' install dependencies`,
    type: 'boolean'
  })
  .option('yarn', {
    desc: `use 'yarn' install dependencies`,
    type: 'boolean'
  })

cli.parse()
