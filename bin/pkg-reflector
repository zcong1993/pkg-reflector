#!/usr/bin/env node
const meow = require('meow')
const chalk = require('chalk')
const path = require('path')
const update = require('update-notifier')
const errorHandler = require('../src/error-handler')
const pkg = require('../package.json')
const { tasks } = require('../src')

const blue = chalk.blue
const bold = chalk.bold
const dim = chalk.dim
const green = chalk.green

const {input, flags} = meow({
  description: false,
  help: `
    install a js file depends pkgs automatic using yarn

    ${bold('Usage:')}

      $ pkg-reflector <file[s]> [options]

    ${bold('Options:')}

      ${blue('--dev, -d')}               ${dim('# save updated pkgs as devDependencies, default is dependencies')}

    ${bold('Examples:')}

      ${blue('$ pkg-reflector src/* --dev')}

      ${dim('# will install the file depends pkgs')}
  `
}, {
  alias: {
    v: 'version',
    d: 'dev',
    h: 'help'
  }
})

update({pkg}).notify()

tasks(input, flags)
  .then((ctx) => {
    const updatedPkgs = ctx.deps.toString()
    console.log(green(`\n${chalk.gray.bgGreen.bold('success')} ${updatedPkgs} installed !\n`))
  })
  .catch(errorHandler)
